<!-- Add to list modal -->
<div class="flex justify-center items-center fixed top-0 left-0 w-screen h-screen z-50 bg-black/60"
  *ngIf="listModalActive">
  <!-- normal bg -->
  <div class="absolute w-full h-full z-10" (click)="hideListModal()"></div>
  <!-- Loader -->
  <div class="flex justify-center items-center w-full h-full" *ngIf="isListLoading"><app-loader></app-loader></div>
  <!-- lists -->
  <div class="p-5 w-full max-w-[400px] rounded-xl z-20 bg-white text-slate-950" *ngIf="!isListLoading">
    <h1 class="pb-5 text-center text-xl">Choose List</h1>
    <div class="flex flex-col justify-between">

      <ul class="flex flex-col gap-2 h-[300px] overflow-auto" *ngIf="!isListLoading">
        <li
          class="p-2 w-full rounded-md text-sm bg-amber-50/20 shadow-md shadow-black/10 cursor-pointer ease-out transition-all hover:-translate-y-1"
          [ngClass]="{'active-list-item' : activeListItem == list.id}" *ngFor="let list of lists"
          (click)="activateListItem(list.id)">
          {{list.name}}
        </li>
      </ul>
      <button class="flex justify-center items-center mt-3 w-full bg-emerald-800 hover:bg-emerald-950 text-white"
        (click)="addMovieToList(activeListItem, movieToAdd)">Add
        Movie</button>
    </div>
  </div>
</div>



<!-- Loader -->
<div class="flex justify-center items-center w-full h-[200px]" *ngIf="isLoading">
  <app-loader></app-loader>
</div>

<!-- Review modal -->
<div class="flex justify-center items-center fixed top-0 left-0 w-screen h-screen z-50 bg-black/60"
  *ngIf="reviewModalActive">
  <!-- Review form -->
  <!-- Loader -->
  <app-loader *ngIf="isReviewSubmitLoading"></app-loader>

  <!-- normal bg -->
  <div class="absolute w-full h-full z-10" *ngIf="!isEditing" (click)="hideReviewModal()"></div>
  <!-- edit bg -->
  <div class="absolute w-full h-full z-10" *ngIf="isEditing" (click)="hideEditReviewModal()"></div>
  <!-- Form -->
  <form class="w-full max-w-[400px] rounded-xl z-20" (ngSubmit)="createReview(f, movie)" #f="ngForm"
    *ngIf="!isReviewSubmitLoading">
    <h1>Write Review</h1>

    <!-- rating -->
    <div class="form-item">
      <label for="rating">Rating:</label>
      <input type="number" name="rating" id="rating" placeholder="(between 0 - 10)" ngModel required min="0" max="10"
        #rating="ngModel">
      <span class="error" *ngIf="rating.invalid && rating.touched">
        Rating required between 0 - 10.
      </span>
    </div>

    <!-- description -->
    <div class="form-item">
      <label for="description">Description:</label>
      <textarea name="description" id="description" rows="4" placeholder="Write review..." ngModel required
        #description="ngModel"></textarea>
      <span class="error" *ngIf="description.invalid && description.touched">
        Description required.
      </span>
    </div>

    <!-- submit -->
    <button class="bg-emerald-800 hover:bg-emerald-959 disabled:opacity-60 disabled:bg-emerald-800" type="submit"
      [disabled]="!f.valid">Submit Review</button>
  </form>
</div>

<div *ngIf="!isLoading">
  <!-- Banner -->
  <div class="flex justify-center relative pt-10 pb-14">
    <!-- Backdrop -->
    <img class="absolute top-0 left-0 w-full h-full object-cover -z-20 backdrop-brightness-50"
      src="{{imageBaseUrl}}/original/{{movie.backdrop_path}}" alt="">
    <!-- Filter -->
    <div class="absolute top-0 left-0 w-full h-full bg-black -z-10 opacity-60"></div>
    <div class="flex justify-center items-center w-full max-w-screen-lg gap-10">
      <!-- Image-->
      <div class="min-w-[300px] h-[450px] rounded-md overflow-hidden">
        <img class="w-full h-full object-cover" src="{{imageBaseUrl}}/w500/{{movie.poster_path}}" alt="">
      </div>
      <!-- Movie details -->
      <div class="flex flex-col gap-5">
        <div class="text-base">
          <h1 class="text-3xl">{{movie.title}}</h1>
          <div class="flex gap-3">
            <p>{{movie.release_date}}</p>
            -
            <ul class="flex">
              <li *ngFor="let genre of movie.genres; let last=last">
                <span>{{genre.name}}</span>
                <span class="mr-1" *ngIf="!last">,</span>
              </li>
            </ul>
            -
            <p>{{movie.runtime}}min</p>
          </div>
        </div>
        <div class="flex items-center gap-6">
          <div class="flex items-center gap-3">
            <div
              class="flex justify-center items-center w-14 h-14 rounded-full border-solid border-2 bg-purple-900 text-sm"
              *ngIf="movie.totalRating == 0">
              N/A
            </div>
            <div
              class="flex justify-center items-center w-14 h-14 rounded-full border-solid border-2 bg-purple-900 text-sm"
              *ngIf="movie.totalRating > 0">
              {{movie.totalRating}}
            </div>
            <p class="font-bold">User<br>Score</p>
          </div>
          <!-- Icons -->
          <div class="flex justify-center items-center w-11 h-11 rounded-full bg-cyan-900 text-sm">
            <fa-icon class="text-base cursor-pointer transition-all ease-in-out duration-300 hover:text-sky-500 "
              [icon]="faPlus" (click)="showListModal(movie)"></fa-icon>
          </div>
          <div class="flex justify-center items-center w-11 h-11 rounded-full bg-cyan-900 text-sm">
            <fa-icon class="text-base cursor-pointer transition-all ease-in-out duration-300 hover:text-yellow-500"
              [icon]="faStar" (click)="showReviewModal()"></fa-icon>
          </div>
        </div>
        <p class="text-gray-300"><i>{{movie.tagline}}</i></p>
        <h2 class="font-bold text-xl">Overview</h2>
        <p>{{movie.overview}}</p>
      </div>
    </div>
  </div>

  <!-- Movie recommendations -->
  <div class="my-10 flex flex-col items-center">
    <h1 class="mb-5 text-2xl font-bold text-slate-950">Recommendations</h1>

    <!-- Loader -->
    <div *ngIf="isRecommendationLoading">
      <app-loader></app-loader>
    </div>

    <div class="relative px-11 w-full max-w-screen-xl" *ngIf="!isRecommendationLoading">
      <owl-carousel-o [options]="customOptions" (dragging)="isDragging = $event.dragging">
        <ng-container *ngFor="let movie of movies">
          <ng-template carouselSlide>
            <!-- Image card -->
            <div class="relative">
              <!-- Image container-->
              <div class="rounded-xl overflow-hidden cursor-pointer" owlRouterLink='/browse/movie/{{movie.id}}'
                [stopLink]="isDragging">
                <img class="max-w-10 aspect-[0.667] bg-gray-500" src="{{imageBaseUrl}}/w500/{{movie.poster_path}}"
                  alt="{{movie.title}} poster">
              </div>
              <!-- Icons -->
              <div class="flex flex-col items-center absolute top-3 right-2 z-10">
                <fa-icon
                  class="text-2xl text-white/80 cursor-pointer transition-all ease-in-out duration-300 hover:text-blue-500"
                  [icon]="faSquarePlus" (click)="showListModal(movie)"></fa-icon>
              </div>
              <!-- Movie rating-->
              <div
                class="flex justify-center items-center absolute -bottom-2 -left-2 w-11 h-11 rounded-full border-solid border-2  bg-purple-900 text-sm">
                <div *ngIf="movie.totalVotes == 0">N/A</div>
                <div *ngIf="movie.totalVotes > 0">{{movie.totalRating}}</div>
              </div>
            </div>
            <!-- Movie details -->
            <p class="mt-3 font-semibold text-base text-slate-950">{{movie.title}}</p>
            <p class="text-sm text-slate-700">{{movie.release_date}}</p>
          </ng-template>
        </ng-container>
      </owl-carousel-o>
    </div>
  </div>

  <!-- Reviews -->
  <div class="my-10 flex flex-col items-center text-slate-950">
    <h1 class="mb-5 text-2xl font-bold">Reviews</h1>
    <!-- Loader -->
    <div *ngIf="isReviewLoading">
      <app-loader></app-loader>
    </div>
    <div class="flex items-start gap-5 px-5 w-full max-w-screen-lg" *ngIf="!isReviewLoading">
      <button class="py-3 px-5 rounded-2xl bg-blue-950 text-white text-sm whitespace-nowrap hover:scale-105"
        (click)="showReviewModal()">Write
        Review</button>
      <p *ngIf="reviews.length == 0">No user reviews...</p>
      <ul class="flex flex-col gap-5 w-full max-w-screen-xl" *ngIf="reviews.length > 0">
        <!-- Review card -->
        <li
          class="flex justify-between items-start gap-5 p-5 w-full bg-amber-50/30 shadow-lg shadow-black/20 rounded-md border-solid border-[1px] border-black/20"
          *ngFor="let review of reviews | paginate: {itemsPerPage: 5, currentPage: page, totalItems: reviews.length}">
          <!-- Left -->
          <div class="flex gap-5">
            <!-- Profile avatar -->
            <div class="flex justify-center items-center w-14 h-14 rounded-full bg-slate-800">
              <img src="{{review.avatar}}" alt="" *ngIf="review.avatar">
              <fa-icon class="text-indigo-500 " [icon]="faUser" *ngIf="!review.avatar"></fa-icon>
            </div>


            <!-- Review details -->
            <div class="flex flex-col gap-5">
              <div class="flex gap-3">
                <h2 class="font-bold text-lg">{{review.username}}</h2>
                <div
                  class="flex justify-center items-center gap-2 py-1 px-5 rounded-xl bg-emerald-800 text-white text-xs">
                  <fa-icon [icon]="faStar"></fa-icon>
                  {{review.rating}}
                </div>
              </div>
              <div class="text-base">
                {{review.description}}
              </div>
            </div>
          </div>
          <!-- Right -->
          <!-- Actions -->
          <div *ngIf="username == review.username">
            <button class="mr-4 py-0 px-3 pb-1 rounded-none border-b-slate-950 duration-100 hover:border-b-2"
              (click)="showEditReviewModal(review.id)">edit</button>
            <button class="py-0 px-3 pb-1 rounded-none border-b-slate-950 duration-100 hover:border-b-2"
              (click)="deleteReview(review.id, movie.id)">delete</button>
          </div>
        </li>

        <!-- Pagination -->
        <div class="flex justify-center items-center mt-10" *ngIf="!isReviewLoading">
          <pagination-controls class="pagination" [maxSize]="5" previousLabel="" nextLabel=""
            (pageChange)="page = $event"></pagination-controls>
        </div>
      </ul>
    </div>
  </div>
</div>